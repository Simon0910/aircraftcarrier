package ${cfg.EditCmdExe_p};

import com.aircraftcarrier.framework.model.response.SingleResponse;
import com.aircraftcarrier.framework.tookit.BeanUtil;
import ${cfg.EditCmd_f};
import ${cfg.Gateway_f};
import ${cfg.Entity_f};
import org.springframework.stereotype.Component;

import javax.annotation.Resource;


/**
 * 编辑保存 执行类
 *
 * @author ${author}
 * @date ${date}
 * @since 1.0
 */
@Component
public class ${cfg.EditCmdExe_n} {

    /**
     * ${cfg.Gateway_n}
     */
    @Resource
    #set ($gatewayI = ${cfg.Gateway_n_i})
    private ${cfg.Gateway_n} ${gatewayI};


    public SingleResponse<Void> execute(${cfg.EditCmd_n} editCmd) {
        beforeCheck(editCmd);
        ${cfg.Entity_n} entity = copyEdit(editCmd);
        ${gatewayI}.editSave(editCmd.getId(), entity, editCmd.getOperator());
        return SingleResponse.ok();
    }

    /**
    * 前置校验, 参数校验等
    *
    * @param editCmd 编辑Cmd
    */
    private void beforeCheck(${cfg.EditCmd_n} editCmd) {
        // 1. Entity entity = getById(editCmd.getId());
        // if (editCmd.getBizNo() != entity.getBizNo()) throw 用户错误
        // 针对多个人看到同一条记录的情况, 并做编辑时的乐观锁+版本号解决冲突
        // 2. if editCmd.getVersion() != entity.getVersion() throw 其他管理员已编辑,请重试
    }

    /**
     * 复制用户确认后的信息
     *
     * @param editCmd 编辑Cmd
     * @return EiEntity 用户确认后的信息
     */
    private ${cfg.Entity_n} copyEdit(${cfg.EditCmd_n} editCmd) {
        ${cfg.Entity_n} entity = new ${cfg.Entity_n}();
#foreach($field in ${table.fields})
    #set ($sfN = ${field.propertyName.substring(0, 1).toUpperCase()} + ${field.propertyName.substring(1)})
        entity.set${sfN}(editCmd.get${sfN}());
#end
        return entity;
    }
}
